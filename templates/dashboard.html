{% extends "base.html" %}

{% block title %}Dashboard - Manajet{% endblock %}

{% block content %}
<div style="margin-bottom: 32px;">
    <h1>Dashboard</h1>
    <p style="color: #64748b; margin-top: 8px; font-size: 14px;">Welcome back, <strong style="color: #0f172a;">{{ user.username }}</strong> <span style="color: #cbd5e1;">Â·</span> <span style="text-transform: capitalize; color: var(--primary); font-weight: 600;">{{ user.role }}</span></p>
</div>

<!-- Stats Overview -->
<div class="grid-4" style="margin-bottom: 32px;">
    <div class="card" style="border-left: 4px solid #6366f1;">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: #64748b; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px;">Total Aircraft</p>
                <div style="font-size: 36px; font-weight: 700; color: #0f172a; margin-bottom: 4px;">{{ stats.total_jets }}</div>
                <p style="color: #64748b; font-size: 13px;">
                    <span style="color: #10b981; font-weight: 600;">{{ stats.available_jets }}</span> available
                </p>
            </div>
            <div style="background: #eef2ff; padding: 12px; border-radius: 12px;">
                <span style="font-size: 28px;">âœˆï¸</span>
            </div>
        </div>
    </div>

    <div class="card" style="border-left: 4px solid #ec4899;">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: #64748b; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px;">Active Flights</p>
                <div style="font-size: 36px; font-weight: 700; color: #0f172a; margin-bottom: 4px;">{{ stats.active_flights }}</div>
                <p style="color: #64748b; font-size: 13px;">
                    <span style="color: #ec4899; font-weight: 600;">{{ stats.in_flight_jets }}</span> in flight
                </p>
            </div>
            <div style="background: #fdf2f8; padding: 12px; border-radius: 12px;">
                <span style="font-size: 28px;">ğŸ›«</span>
            </div>
        </div>
    </div>

    <div class="card" style="border-left: 4px solid #14b8a6;">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: #64748b; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px;">Passengers</p>
                <div style="font-size: 36px; font-weight: 700; color: #0f172a; margin-bottom: 4px;">{{ stats.total_passengers }}</div>
                <p style="color: #64748b; font-size: 13px;">Registered</p>
            </div>
            <div style="background: #f0fdfa; padding: 12px; border-radius: 12px;">
                <span style="font-size: 28px;">ğŸ‘¥</span>
            </div>
        </div>
    </div>

    <div class="card" style="border-left: 4px solid #f59e0b;">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p style="color: #64748b; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px;">Maintenance</p>
                <div style="font-size: 36px; font-weight: 700; color: #0f172a; margin-bottom: 4px;">{{ stats.maintenance_jets }}</div>
                <p style="color: #64748b; font-size: 13px;">Under maintenance</p>
            </div>
            <div style="background: #fffbeb; padding: 12px; border-radius: 12px;">
                <span style="font-size: 28px;">ğŸ”§</span>
            </div>
        </div>
    </div>
</div>

<!-- Activity Feed -->
<div class="grid-2">
    <!-- Left Column -->
    <div>
        <!-- Active Flights -->
        <div class="card">
            <h2>ğŸ›« Active Flights</h2>
            {% if activity.active_flights %}
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Flight</th>
                                <th>Route</th>
                                <th>Aircraft</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for flight in activity.active_flights %}
                            <tr>
                                <td><a href="{{ url_for('view_flight', flight_id=flight.flight_id) }}">{{ flight.flight_id }}</a></td>
                                <td>{{ flight.departure }} â†’ {{ flight.destination }}</td>
                                <td>{{ manager.get_jet(flight.jet_id).model if manager.get_jet(flight.jet_id) else flight.jet_id }}</td>
                                <td><span class="status-badge status-in-progress">{{ flight.status }}</span></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p style="color: #888; padding: 20px; text-align: center;">No active flights</p>
            {% endif %}
        </div>

        <!-- Flights This Week -->
        <div class="card">
            <h2>ğŸ“… Flights This Week ({{ activity.week_start }} to {{ activity.week_end }})</h2>
            {% if activity.flights_this_week %}
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Flight</th>
                                <th>Route</th>
                                <th>Departure</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for flight in activity.flights_this_week %}
                            <tr>
                                <td><a href="{{ url_for('view_flight', flight_id=flight.flight_id) }}">{{ flight.flight_id }}</a></td>
                                <td>{{ flight.departure }} â†’ {{ flight.destination }}</td>
                                <td>{{ flight.departure_time }}</td>
                                <td><span class="status-badge status-{{ flight.status.lower().replace(' ', '-') }}">{{ flight.status }}</span></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p style="color: #888; padding: 20px; text-align: center;">No flights scheduled this week</p>
            {% endif %}
        </div>

        <!-- Upcoming Flights -->
        <div class="card">
            <h2>ğŸ”œ Upcoming Flights (Next 7 Days)</h2>
            {% if activity.upcoming_flights %}
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Flight</th>
                                <th>Route</th>
                                <th>Departure</th>
                                <th>Passengers</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for flight in activity.upcoming_flights %}
                            <tr>
                                <td><a href="{{ url_for('view_flight', flight_id=flight.flight_id) }}">{{ flight.flight_id }}</a></td>
                                <td>{{ flight.departure }} â†’ {{ flight.destination }}</td>
                                <td>{{ flight.departure_time }}</td>
                                <td>{{ flight.passenger_ids|length }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p style="color: #888; padding: 20px; text-align: center;">No upcoming flights</p>
            {% endif %}
        </div>
    </div>

    <!-- Right Column -->
    <div>
        <!-- Active Maintenance -->
        <div class="card">
            <h2>ğŸ”§ Active Maintenance</h2>
            {% if activity.active_maintenance %}
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Aircraft</th>
                                <th>Type</th>
                                <th>Scheduled</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for maint in activity.active_maintenance %}
                            <tr>
                                <td><a href="{{ url_for('view_maintenance', maintenance_id=maint.maintenance_id) }}">{{ maint.maintenance_id }}</a></td>
                                <td>{{ manager.get_jet(maint.jet_id).model if manager.get_jet(maint.jet_id) else maint.jet_id }}</td>
                                <td>{{ maint.maintenance_type }}</td>
                                <td>{{ maint.scheduled_date }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p style="color: #888; padding: 20px; text-align: center;">No active maintenance</p>
            {% endif %}
        </div>

        <!-- Maintenance This Week -->
        <div class="card">
            <h2>ğŸ—“ï¸ Maintenance This Week</h2>
            {% if activity.maintenance_this_week %}
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Aircraft</th>
                                <th>Type</th>
                                <th>Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for maint in activity.maintenance_this_week %}
                            <tr>
                                <td><a href="{{ url_for('view_maintenance', maintenance_id=maint.maintenance_id) }}">{{ maint.maintenance_id }}</a></td>
                                <td>{{ manager.get_jet(maint.jet_id).model if manager.get_jet(maint.jet_id) else maint.jet_id }}</td>
                                <td>{{ maint.maintenance_type }}</td>
                                <td>{{ maint.scheduled_date }}</td>
                                <td><span class="status-badge status-{{ maint.status.lower().replace(' ', '-') }}">{{ maint.status }}</span></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p style="color: #888; padding: 20px; text-align: center;">No maintenance scheduled this week</p>
            {% endif %}
        </div>

        <!-- Recently Completed -->
        <div class="card">
            <h2>âœ… Recently Completed Flights</h2>
            {% if activity.recent_completed %}
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Flight</th>
                                <th>Route</th>
                                <th>Completed</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for flight in activity.recent_completed %}
                            <tr>
                                <td><a href="{{ url_for('view_flight', flight_id=flight.flight_id) }}">{{ flight.flight_id }}</a></td>
                                <td>{{ flight.departure }} â†’ {{ flight.destination }}</td>
                                <td>{{ flight.arrival_time }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p style="color: #888; padding: 20px; text-align: center;">No recently completed flights</p>
            {% endif %}
        </div>

        <!-- Quick Stats -->
        <div class="card">
            <h2>ğŸ“Š Quick Stats</h2>
            <div style="display: grid; gap: 16px;">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px; background: #f8fafc; border-radius: 8px; border-left: 3px solid #6366f1;">
                    <span style="color: #64748b; font-weight: 500; font-size: 14px;">Total Crew</span>
                    <strong style="font-size: 28px; color: #0f172a;">{{ stats.total_crew }}</strong>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px; background: #f8fafc; border-radius: 8px; border-left: 3px solid #ec4899;">
                    <span style="color: #64748b; font-weight: 500; font-size: 14px;">Total Flights</span>
                    <strong style="font-size: 28px; color: #0f172a;">{{ stats.total_flights }}</strong>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px; background: #f8fafc; border-radius: 8px; border-left: 3px solid #f59e0b;">
                    <span style="color: #64748b; font-weight: 500; font-size: 14px;">Maintenance Records</span>
                    <strong style="font-size: 28px; color: #0f172a;">{{ stats.total_maintenance }}</strong>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Automatic Status Updates (Admin Only) -->
{% if user.role == 'admin' %}
<div class="card" style="margin-top: 32px; background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%); border-left: 4px solid #6366f1;">
    <h2 style="color: #4338ca; border-bottom: none; padding-bottom: 0;">ğŸ”„ Automatic Status Updates</h2>
    <p style="color: #64748b; margin-bottom: 20px; font-size: 14px;">
        Flights and maintenance records automatically update their status based on time. System checks every 5 minutes.
    </p>
    <div style="display: flex; gap: 12px;">
        <form method="POST" action="{{ url_for('manual_status_update') }}" style="display: inline;">
            <button type="submit" class="btn btn-primary">ğŸ”„ Update All Statuses Now</button>
        </form>
        <a href="{{ url_for('upcoming_events') }}" class="btn btn-secondary">ğŸ“… View Upcoming Events</a>
    </div>
</div>
{% endif %}

<!-- Quick Actions -->
<div class="card" style="margin-top: 32px;">
    <h2>âš¡ Quick Actions</h2>
    <div class="grid-4">
        {% if user.role in ['customer', 'admin'] %}
        <a href="{{ url_for('add_passenger') }}" class="btn btn-primary">â• Add Passenger</a>
        {% endif %}
        <a href="{{ url_for('add_flight') }}" class="btn btn-success">âœˆï¸ Schedule Flight</a>
        {% if user.role in ['admin', 'crew', 'mechanic'] %}
        <a href="{{ url_for('add_maintenance') }}" class="btn btn-secondary">ğŸ”§ Schedule Maintenance</a>
        {% endif %}
        {% if user.role == 'admin' %}
        <a href="{{ url_for('customers') }}" class="btn btn-primary">ğŸ‘¥ Manage Customers</a>
        {% endif %}
        <a href="{{ url_for('jets') }}" class="btn btn-primary">ğŸ›©ï¸ View All Aircraft</a>
    </div>
</div>

{% endblock %}
