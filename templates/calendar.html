{% extends "base.html" %}

{% block title %}Flight Calendar - Manajet{% endblock %}

{% block content %}
<div style="margin-bottom: 32px;">
    <h1>Flight Calendar</h1>
    <p style="color: #64748b; margin-top: 8px; font-size: 14px;">Visual overview of all scheduled flights</p>
</div>

<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <h2 style="margin: 0; border: none; padding: 0;">Schedule Overview</h2>
        <div style="display: flex; gap: 12px;">
            <a href="{{ url_for('add_flight') }}" class="btn btn-primary">✈️ Schedule Flight</a>
        </div>
    </div>

    <!-- Calendar Legend -->
    <div style="display: flex; gap: 20px; margin-bottom: 24px; padding: 16px; background: #f8fafc; border-radius: 8px;">
        <div style="display: flex; align-items: center; gap: 8px;">
            <div style="width: 16px; height: 16px; background: #3b82f6; border-radius: 4px;"></div>
            <span style="font-size: 13px; color: #64748b;">Scheduled</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
            <div style="width: 16px; height: 16px; background: #10b981; border-radius: 4px;"></div>
            <span style="font-size: 13px; color: #64748b;">In Progress</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
            <div style="width: 16px; height: 16px; background: #64748b; border-radius: 4px;"></div>
            <span style="font-size: 13px; color: #64748b;">Completed</span>
        </div>
    </div>

    <!-- Calendar Container -->
    <div id="calendar" style="background: white;"></div>
</div>

<!-- Flight Detail Modal -->
<div id="flightModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; padding: 20px;">
    <div style="max-width: 600px; margin: 50px auto; background: white; border-radius: 12px; padding: 32px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 24px;">
            <h2 style="margin: 0; border: none; padding: 0;" id="modalTitle">Flight Details</h2>
            <button onclick="closeModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b; padding: 0; line-height: 1;">&times;</button>
        </div>
        <div id="modalContent"></div>
    </div>
</div>

<!-- FullCalendar CSS and JS -->
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css' rel='stylesheet' />
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>

<style>
    /* FullCalendar customization */
    .fc {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .fc .fc-button {
        background: #6366f1;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        font-weight: 600;
        text-transform: none;
        box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    .fc .fc-button:hover {
        background: #4f46e5;
    }

    .fc .fc-button-primary:not(:disabled).fc-button-active {
        background: #4338ca;
    }

    .fc .fc-button-primary:disabled {
        background: #cbd5e1;
        opacity: 0.5;
    }

    .fc-theme-standard td, .fc-theme-standard th {
        border-color: #e2e8f0;
    }

    .fc .fc-col-header-cell {
        background: #f8fafc;
        padding: 12px 4px;
        font-weight: 600;
        color: #475569;
        text-transform: uppercase;
        font-size: 11px;
        letter-spacing: 0.05em;
    }

    .fc .fc-daygrid-day-number {
        color: #0f172a;
        font-weight: 500;
        padding: 8px;
    }

    .fc .fc-daygrid-day.fc-day-today {
        background: #eef2ff !important;
    }

    .fc-event {
        border: none;
        border-radius: 4px;
        padding: 4px 8px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .fc-event:hover {
        opacity: 0.9;
        transform: translateY(-1px);
    }

    .fc-event-title {
        font-weight: 600;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');

        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
            },
            height: 'auto',
            events: '/api/calendar/flights',
            eventClick: function(info) {
                showFlightDetails(info.event);
            },
            eventTimeFormat: {
                hour: '2-digit',
                minute: '2-digit',
                meridiem: 'short'
            },
            eventClassNames: function(arg) {
                // Add custom classes based on status
                if (arg.event.extendedProps.status === 'Scheduled') {
                    return ['event-scheduled'];
                } else if (arg.event.extendedProps.status === 'In Progress') {
                    return ['event-in-progress'];
                } else if (arg.event.extendedProps.status === 'Completed') {
                    return ['event-completed'];
                }
            }
        });

        calendar.render();
    });

    function showFlightDetails(event) {
        const props = event.extendedProps;
        const modal = document.getElementById('flightModal');
        const content = document.getElementById('modalContent');

        content.innerHTML = `
            <div style="display: grid; gap: 16px;">
                <div style="display: flex; justify-content: space-between; padding: 16px; background: #f8fafc; border-radius: 8px;">
                    <div>
                        <p style="color: #64748b; font-size: 12px; margin-bottom: 4px;">Flight ID</p>
                        <p style="font-weight: 600; color: #0f172a;">${props.flight_id}</p>
                    </div>
                    <div>
                        <span class="status-badge status-${props.status.toLowerCase().replace(' ', '-')}">${props.status}</span>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 16px; padding: 16px; border: 1px solid #e2e8f0; border-radius: 8px;">
                    <div>
                        <p style="color: #64748b; font-size: 12px; margin-bottom: 4px;">Departure</p>
                        <p style="font-weight: 600; color: #0f172a; font-size: 18px;">${props.departure}</p>
                        <p style="color: #64748b; font-size: 13px;">${event.start.toLocaleString()}</p>
                    </div>
                    <div style="font-size: 24px; color: #cbd5e1;">→</div>
                    <div>
                        <p style="color: #64748b; font-size: 12px; margin-bottom: 4px;">Destination</p>
                        <p style="font-weight: 600; color: #0f172a; font-size: 18px;">${props.destination}</p>
                        <p style="color: #64748b; font-size: 13px;">${event.end ? event.end.toLocaleString() : 'N/A'}</p>
                    </div>
                </div>

                <div style="padding: 16px; background: #f8fafc; border-radius: 8px;">
                    <p style="color: #64748b; font-size: 12px; margin-bottom: 8px;">Aircraft</p>
                    <p style="font-weight: 600; color: #0f172a;">${props.jet_model || props.jet_id}</p>
                </div>

                <div style="padding: 16px; background: #f8fafc; border-radius: 8px;">
                    <p style="color: #64748b; font-size: 12px; margin-bottom: 8px;">Passengers</p>
                    <p style="font-weight: 600; color: #0f172a;">${props.passenger_count} passenger(s)</p>
                </div>

                <div style="display: flex; gap: 12px; margin-top: 8px;">
                    <a href="/flights/${props.flight_id}" class="btn btn-primary" style="flex: 1; text-align: center;">View Details</a>
                    <button onclick="closeModal()" class="btn btn-secondary" style="flex: 1;">Close</button>
                </div>
            </div>
        `;

        modal.style.display = 'block';
    }

    function closeModal() {
        document.getElementById('flightModal').style.display = 'none';
    }

    // Close modal when clicking outside
    document.getElementById('flightModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeModal();
        }
    });
</script>

<style>
    .event-scheduled {
        background: #3b82f6 !important;
        border-color: #2563eb !important;
    }

    .event-in-progress {
        background: #10b981 !important;
        border-color: #059669 !important;
    }

    .event-completed {
        background: #64748b !important;
        border-color: #475569 !important;
    }
</style>

{% endblock %}
